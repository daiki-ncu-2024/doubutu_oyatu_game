<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã©ã†ã¶ã¤ãŠã‚„ã¤ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f9ff; /* èƒŒæ™¯è‰² (æ°´è‰²ç³») */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* ä¸Šå¯„ã›ã«å¤‰æ›´ */
            min-height: 100vh;
            margin: 0;
            padding: 20px; /* ä¸Šä¸‹ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å°‘ã—å¢—ã‚„ã™ */
            box-sizing: border-box;
        }
        .game-container {
            display: flex;
            flex-direction: row; /* PCã§ã¯æ¨ªä¸¦ã³ã‚’åŸºæœ¬ã¨ã™ã‚‹ */
            flex-wrap: nowrap;   /* æŠ˜ã‚Šè¿”ã•ãªã„ã‚ˆã†ã«ã™ã‚‹ */
            justify-content: center; /* ä¸­å¤®æƒãˆ */
            align-items: flex-start; /* ä¸Šç«¯æƒãˆ */
            gap: 24px;
            width: 100%;
            max-width: 1000px; /* å…¨ä½“ã®æœ€å¤§å¹…ã‚’å°‘ã—åºƒã’ã‚‹ */
        }
        .board-and-info-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1; /* æ®‹ã‚Šã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’åŸ‹ã‚ã‚‹ */
            min-width: 0; /* flexã‚¢ã‚¤ãƒ†ãƒ ã®ç¸®å°å¯¾ç­– */
        }
        .board-container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            width: 100%; /* è¦ªè¦ç´ ã«è¿½å¾“ */
            max-width: 500px; /* ãƒœãƒ¼ãƒ‰è‡ªä½“ã®æœ€å¤§å¹… */
        }
        .board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr);
            width: 100%; /* ã‚³ãƒ³ãƒ†ãƒŠã«åˆã‚ã›ã‚‹ */
            aspect-ratio: 5 / 4; /* ç¸¦æ¨ªæ¯”ã‚’å›ºå®š */
            /* width: clamp(280px, 80vw, 450px); */ /* å›ºå®šå¹…ã‹ã‚‰å¤‰æ›´ */
            /* height: clamp(224px, 64vw, 360px); */
            border: 2px solid #60a5fa;
            border-radius: 8px;
            gap: 2px;
            background-color: #93c5fd;
        }
        .cell {
            background-color: #eff6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.2rem, 5vmin, 2rem); /* vmin ã‚’ä½¿ã£ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã« */
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid #dbeafe;
            border-radius: 4px;
        }
        .cell:hover {
            background-color: #dbeafe;
        }
        .piece-p1 { color: #2563eb; }
        .piece-p2 .piece-symbol {
            display: inline-block;
            transform: rotate(180deg);
        }
        .piece-p2 { color: #e11d48; }


        .selected {
            background-color: #fcd34d !important;
            outline: 3px solid #f59e0b;
        }
        .valid-move {
            background-color: #86efac !important;
            outline: 3px solid #16a34a;
        }
        .info-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            text-align: center;
            width: 100%; /* è¦ªè¦ç´ ã«è¿½å¾“ */
            max-width: 500px; /* ãƒœãƒ¼ãƒ‰ã«åˆã‚ã›ã‚‹ */
        }
        .info-panel h2 {
            font-size: clamp(1.1rem, 4.5vw, 1.6rem);
            margin-bottom: 10px;
            color: #1e3a8a;
        }
        .info-panel p {
            font-size: clamp(0.9rem, 3.5vw, 1.1rem);
            color: #374151;
            margin-bottom: 8px;
        }
        button {
            background-color: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: clamp(0.9rem, 3.5vw, 1.1rem);
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
        }
        button:hover {
            background-color: #2563eb;
        }

        /* æ“ä½œèª¬æ˜ã‚¨ãƒªã‚¢ */
        .how-to-play {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            width: 280px; /* å›ºå®šå¹…ã«è¨­å®š */
            flex-shrink: 0; /* ã“ã®ã‚¨ãƒªã‚¢ã¯ç¸®ã¾ãªã„ã‚ˆã†ã«ã™ã‚‹ */
            align-self: flex-start;
        }
        .how-to-play h3 {
            font-size: clamp(1.1rem, 4.5vw, 1.5rem);
            color: #1e3a8a;
            margin-bottom: 16px;
            border-bottom: 2px solid #60a5fa;
            padding-bottom: 8px;
        }
        .how-to-play p {
            font-size: clamp(0.85rem, 3vw, 1rem);
            color: #374151;
            margin-bottom: 10px;
        }
        .how-to-play .piece-move-explanation {
            margin-bottom: 20px;
        }
        .how-to-play .piece-name {
            font-weight: bold;
            font-size: clamp(1rem, 3.8vw, 1.2rem);
            margin-bottom: 8px;
            display: block;
        }
        .piece-p1-example { color: #2563eb; }
        .piece-p2-example { color: #e11d48; }
        .piece-p2-example .piece-symbol-example {
            display: inline-block;
            transform: rotate(180deg);
        }

        .move-grid {
            display: grid;
            grid-template-columns: repeat(3, 28px); /* å°‘ã—å¤§ãã */
            grid-template-rows: repeat(3, 28px);
            gap: 1px;
            background-color: #cbd5e1;
            border: 1px solid #94a3b8;
            margin-bottom: 8px;
            width: 86px; /* (28*3) + (1*2) */
            height: 86px;
        }
        .move-grid-cell {
            width: 28px;
            height: 28px;
            background-color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem; /* å°‘ã—å¤§ãã */
        }
        .move-grid-cell.piece {
            /* ã‚¹ã‚¿ã‚¤ãƒ«ã¯JSã§é©ç”¨ */
        }
        .move-grid-cell.highlight {
            background-color: #86efac;
            outline: 1px solid #16a34a;
        }

        /* ãƒ¢ãƒã‚¤ãƒ«ç”¨èª¿æ•´: ç”»é¢å¹…ãŒ820pxä»¥ä¸‹ã®å ´åˆ */
        @media (max-width: 820px) { /* ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆèª¿æ•´ */
            .game-container {
                flex-direction: column;
                align-items: center;
            }
            .how-to-play {
                width: 100%; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯å¹…ã‚’åºƒã’ã‚‹ */
                max-width: 500px; /* ãƒœãƒ¼ãƒ‰ã«åˆã‚ã›ã‚‹ */
                margin-top: 24px;
                align-self: center;
            }
            .board-container, .info-panel {
                 width: 100%; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯å¹…ã‚’åºƒã’ã‚‹ */
                 max-width: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="board-and-info-panel">
            <div class="board-container">
                <div id="gameBoard" class="board">
                    </div>
            </div>
            <div id="infoPanel" class="info-panel">
                <h2 id="gameTitle">ã©ã†ã¶ã¤ãŠã‚„ã¤ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼</h2>
                <p id="turnDisplay">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®ç•ªã§ã™</p>
                <p id="messageDisplay"></p>
                <button id="resetButton">ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>

        <div class="how-to-play">
            <h3>ã‚ãã³ã‹ãŸ</h3>
            <p><strong>ã‚‚ãã¦ã:</strong> ã‚ã„ã¦ã® <span class="piece-p1-example">ãƒ©ã‚¤ã‚ªãƒ³</span><span class="piece-symbol-example">ğŸ¦</span> ã‚’ã¤ã‹ã¾ãˆãŸã‚‰å‹ã¡ï¼</p>
            
            <h4>é§’ã®ã†ã”ã</h4>
            <div id="pieceMoveExamplesContainer">
                </div>
            <p><small>â€» <span class="piece-p1-example">é’ã„é§’</span>ãŒã‚ãªãŸ (ä¸‹å´)ã€<span class="piece-p2-example">èµ¤ã„é§’ (<span class="piece-symbol-example">ä¾‹ï¼š</span><span class="piece-p2-example piece-symbol-example">ğŸº</span>)</span>ãŒã‚ã„ã¦ (ä¸Šå´) ã§ã™ã€‚</small></p>
        </div>
    </div>

    <script>
        // --- å®šæ•°å®šç¾© ---
        const BOARD_ROWS = 4;
        const BOARD_COLS = 5;
        const EMPTY_CELL = null;

        const PIECES = {
            LION: { 
                name: "ãƒ©ã‚¤ã‚ªãƒ³", 
                p1Symbol: "ğŸ¦", 
                p2Symbol: "ğŸº",
                moves: [ [-1,-1], [-1,0], [-1,1], [0,-1], [0,1], [1,-1], [1,0], [1,1] ] 
            },
            BEAR: { 
                name: "ãã¾", 
                p1Symbol: "ğŸ»", 
                p2Symbol: "ğŸ¼",
                movesP1: [ [-1,-1], [-1,0], [-1,1] ], 
                movesP2: [ [1,-1], [1,0], [1,1] ]    
            },
            RABBIT: { 
                name: "ã†ã•ã", 
                p1Symbol: "ğŸ°", 
                p2Symbol: "ğŸ¦Š",
                movesP1: [ [-1,-1], [-1,1], [0,-1], [0,1] ], 
                movesP2: [ [1,-1], [1,1], [0,-1], [0,1] ]    
            }
        };

        const PLAYER_1 = "P1";
        const PLAYER_2 = "P2";

        let board = [];
        let currentPlayer = PLAYER_1;
        let selectedPiece = null;
        let gameOver = false;

        const gameBoardElement = document.getElementById('gameBoard');
        const turnDisplayElement = document.getElementById('turnDisplay');
        const messageDisplayElement = document.getElementById('messageDisplay');
        const resetButtonElement = document.getElementById('resetButton');
        const pieceMoveExamplesContainer = document.getElementById('pieceMoveExamplesContainer');


        function createMoveExampleGrid(pieceKey, playerForExample) {
            const pieceInfo = PIECES[pieceKey];
            const exampleDiv = document.createElement('div');
            exampleDiv.classList.add('piece-move-explanation');

            const nameSpan = document.createElement('span');
            nameSpan.classList.add('piece-name');
            nameSpan.textContent = `${pieceInfo.name} (`;
            
            const p1SymbolSpan = document.createElement('span');
            p1SymbolSpan.classList.add('piece-p1-example');
            p1SymbolSpan.textContent = pieceInfo.p1Symbol;
            nameSpan.appendChild(p1SymbolSpan);
            
            nameSpan.append(" / ");

            const p2SymbolSpan = document.createElement('span');
            p2SymbolSpan.classList.add('piece-p2-example');
            const p2InnerSymbol = document.createElement('span');
            p2InnerSymbol.classList.add('piece-symbol-example'); 
            p2InnerSymbol.textContent = pieceInfo.p2Symbol;
            p2SymbolSpan.appendChild(p2InnerSymbol);
            nameSpan.appendChild(p2SymbolSpan);

            nameSpan.append(")");
            exampleDiv.appendChild(nameSpan);

            const grid = document.createElement('div');
            grid.classList.add('move-grid');

            const centerR = 1, centerC = 1; 
            let moveDeltas = [];

            if (pieceInfo.moves) { 
                moveDeltas = pieceInfo.moves;
            } else if (playerForExample === PLAYER_1 && pieceInfo.movesP1) {
                moveDeltas = pieceInfo.movesP1;
            } else if (playerForExample === PLAYER_2 && pieceInfo.movesP2) {
                moveDeltas = pieceInfo.movesP2;
            }

            for (let r = 0; r < 3; r++) {
                for (let c = 0; c < 3; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('move-grid-cell');
                    if (r === centerR && c === centerC) {
                        cell.classList.add('piece');
                        cell.textContent = pieceInfo.p1Symbol; 
                        cell.style.color = '#2563eb'; // P1ã‚«ãƒ©ãƒ¼ã§å›ºå®š
                    } else {
                        const dr = r - centerR;
                        const dc = c - centerC;
                        if (moveDeltas.some(delta => delta[0] === dr && delta[1] === dc)) {
                            cell.classList.add('highlight');
                        }
                    }
                    grid.appendChild(cell);
                }
            }
            exampleDiv.appendChild(grid);
            return exampleDiv;
        }

        function populateMoveExamples() {
            pieceMoveExamplesContainer.innerHTML = ''; 
            pieceMoveExamplesContainer.appendChild(createMoveExampleGrid('LION', PLAYER_1));
            pieceMoveExamplesContainer.appendChild(createMoveExampleGrid('BEAR', PLAYER_1));
            pieceMoveExamplesContainer.appendChild(createMoveExampleGrid('RABBIT', PLAYER_1));
        }


        function initializeBoard() {
            board = Array(BOARD_ROWS).fill(null).map(() => Array(BOARD_COLS).fill(EMPTY_CELL));
            gameOver = false;
            currentPlayer = PLAYER_1;
            selectedPiece = null;
            messageDisplayElement.textContent = "";
            updateTurnDisplay();

            board[3][0] = { type: PIECES.BEAR, player: PLAYER_1 };
            board[3][1] = { type: PIECES.RABBIT, player: PLAYER_1 };
            board[3][2] = { type: PIECES.LION, player: PLAYER_1 };
            board[3][3] = { type: PIECES.RABBIT, player: PLAYER_1 };
            board[3][4] = { type: PIECES.BEAR, player: PLAYER_1 };

            board[0][0] = { type: PIECES.BEAR, player: PLAYER_2 };
            board[0][1] = { type: PIECES.RABBIT, player: PLAYER_2 };
            board[0][2] = { type: PIECES.LION, player: PLAYER_2 };
            board[0][3] = { type: PIECES.RABBIT, player: PLAYER_2 };
            board[0][4] = { type: PIECES.BEAR, player: PLAYER_2 };
            
            populateMoveExamples(); 
            renderBoard();
        }

        function renderBoard() {
            gameBoardElement.innerHTML = '';
            for (let r = 0; r < BOARD_ROWS; r++) {
                for (let c = 0; c < BOARD_COLS; c++) {
                    const cellElement = document.createElement('div');
                    cellElement.classList.add('cell');
                    cellElement.dataset.r = r;
                    cellElement.dataset.c = c;

                    const pieceData = board[r][c];
                    if (pieceData) {
                        const symbolSpan = document.createElement('span');
                        symbolSpan.classList.add('piece-symbol'); 
                        symbolSpan.textContent = pieceData.player === PLAYER_1 ? pieceData.type.p1Symbol : pieceData.type.p2Symbol;
                        cellElement.appendChild(symbolSpan);
                        cellElement.classList.add(pieceData.player === PLAYER_1 ? 'piece-p1' : 'piece-p2');
                    }

                    if (selectedPiece && selectedPiece.r === r && selectedPiece.c === c) {
                        cellElement.classList.add('selected');
                    }

                    if (selectedPiece) {
                        const validMoves = getValidMoves(selectedPiece.r, selectedPiece.c, selectedPiece.player, selectedPiece.piece);
                        if (validMoves.some(move => move.r === r && move.c === c)) {
                            cellElement.classList.add('valid-move');
                        }
                    }
                    
                    cellElement.addEventListener('click', () => handleCellClick(r, c));
                    gameBoardElement.appendChild(cellElement);
                }
            }
        }

        function handleCellClick(r, c) {
            if (gameOver) return;

            const clickedCellContent = board[r][c];

            if (selectedPiece) {
                const validMoves = getValidMoves(selectedPiece.r, selectedPiece.c, selectedPiece.player, selectedPiece.piece);
                const isMoveValid = validMoves.some(move => move.r === r && move.c === c);

                if (isMoveValid) {
                    movePiece(selectedPiece.r, selectedPiece.c, r, c);
                } else if (clickedCellContent && clickedCellContent.player === currentPlayer) {
                    selectedPiece = { r, c, piece: clickedCellContent.type, player: clickedCellContent.player };
                    messageDisplayElement.textContent = `${selectedPiece.piece.name}ã‚’ã›ã‚“ãŸãä¸­ã€‚`;
                } else {
                    messageDisplayElement.textContent = "ãã“ã«ã¯ã†ã”ã‘ã¾ã›ã‚“ã€‚ã»ã‹ã®é§’ã‚’ãˆã‚‰ã¶ã‹ã€ã‚†ã†ã“ã†ãªãƒã‚¹ã‚’ãˆã‚‰ã‚“ã§ãã ã•ã„ã€‚";
                    selectedPiece = null; 
                }
            } else {
                if (clickedCellContent && clickedCellContent.player === currentPlayer) {
                    selectedPiece = { r, c, piece: clickedCellContent.type, player: clickedCellContent.player };
                    messageDisplayElement.textContent = `${selectedPiece.piece.name}ã‚’ã›ã‚“ãŸãã—ã¾ã—ãŸã€‚ã„ã©ã†å…ˆã‚’ãˆã‚‰ã‚“ã§ãã ã•ã„ã€‚`;
                } else if (clickedCellContent) {
                    messageDisplayElement.textContent = "ã‚ã„ã¦ã®é§’ã§ã™ã€‚ã˜ã¶ã‚“ã®é§’ã‚’ãˆã‚‰ã‚“ã§ãã ã•ã„ã€‚";
                } else {
                     messageDisplayElement.textContent = "é§’ã‚’ãˆã‚‰ã‚“ã§ãã ã•ã„ã€‚";
                }
            }
            renderBoard();
        }

        function movePiece(fromR, fromC, toR, toC) {
            const pieceToMove = board[fromR][fromC];
            const targetContent = board[toR][toC];

            if (targetContent && targetContent.type === PIECES.LION) {
                board[toR][toC] = pieceToMove;
                board[fromR][fromC] = EMPTY_CELL;
                renderBoard();
                gameOver = true;
                messageDisplayElement.textContent = `${currentPlayer === PLAYER_1 ? "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1" : "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2"} ã®å‹ã¡ï¼ ${targetContent.type.name} ã‚’ã¤ã‹ã¾ãˆãŸï¼`;
                turnDisplayElement.textContent = "ã‚²ãƒ¼ãƒ ã—ã‚…ã†ã‚Šã‚‡ã†";
                selectedPiece = null;
                return;
            }

            if (targetContent) {
                 messageDisplayElement.textContent = `${pieceToMove.type.name}ã§ã‚ã„ã¦ã®${targetContent.type.name}ã‚’ã¤ã‹ã¾ãˆãŸï¼`;
            } else {
                 messageDisplayElement.textContent = `${pieceToMove.type.name}ã‚’ã†ã”ã‹ã—ã¾ã—ãŸã€‚`;
            }

            board[toR][toC] = pieceToMove;
            board[fromR][fromC] = EMPTY_CELL;
            
            selectedPiece = null;
            switchPlayer();
        }

        function getValidMoves(r, c, player, pieceType) {
            const moves = [];
            if (!pieceType) return moves;

            let moveDeltas = [];
            if (pieceType.moves) { 
                moveDeltas = pieceType.moves;
            } else if (player === PLAYER_1 && pieceType.movesP1) {
                moveDeltas = pieceType.movesP1;
            } else if (player === PLAYER_2 && pieceType.movesP2) {
                moveDeltas = pieceType.movesP2;
            }

            for (const [dr, dc] of moveDeltas) {
                const nr = r + dr;
                const nc = c + dc;
                if (isValidSquare(nr, nc, player)) moves.push({ r: nr, c: nc });
            }
            return moves;
        }

        function isValidSquare(r, c, player) {
            if (r < 0 || r >= BOARD_ROWS || c < 0 || c >= BOARD_COLS) {
                return false;
            }
            const targetCell = board[r][c];
            if (targetCell && targetCell.player === player) {
                return false;
            }
            return true; 
        }

        function switchPlayer() {
            currentPlayer = (currentPlayer === PLAYER_1) ? PLAYER_2 : PLAYER_1;
            updateTurnDisplay();
            if (!gameOver) {
                 messageDisplayElement.textContent = ""; 
            }
            renderBoard(); 
        }

        function updateTurnDisplay() {
            turnDisplayElement.textContent = gameOver ? "ã‚²ãƒ¼ãƒ ã—ã‚…ã†ã‚Šã‚‡ã†" : `${currentPlayer === PLAYER_1 ? "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1 (ä¸‹å´)" : "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2 (ä¸Šå´)"} ã®ç•ªã§ã™`;
        }

        resetButtonElement.addEventListener('click', initializeBoard);

        initializeBoard();
    </script>
</body>
</html>
