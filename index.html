<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>どうぶつおやつパーティー</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* カスタムスタイル */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f9ff; /* 背景色 (水色系) */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* 上寄せに変更 */
            min-height: 100vh;
            margin: 0;
            padding: 20px; /* 上下のパディングを少し増やす */
            box-sizing: border-box;
        }
        .game-container {
            display: flex;
            flex-direction: row; /* PCでは横並びを基本とする */
            flex-wrap: nowrap;   /* 折り返さないようにする */
            justify-content: center; /* 中央揃え */
            align-items: flex-start; /* 上端揃え */
            gap: 24px;
            width: 100%;
            max-width: 1000px; /* 全体の最大幅を少し広げる */
        }
        .board-and-info-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1; /* 残りのスペースを埋める */
            min-width: 0; /* flexアイテムの縮小対策 */
        }
        .board-container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            width: 100%; /* 親要素に追従 */
            max-width: 500px; /* ボード自体の最大幅 */
        }
        .board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr);
            width: 100%; /* コンテナに合わせる */
            aspect-ratio: 5 / 4; /* 縦横比を固定 */
            /* width: clamp(280px, 80vw, 450px); */ /* 固定幅から変更 */
            /* height: clamp(224px, 64vw, 360px); */
            border: 2px solid #60a5fa;
            border-radius: 8px;
            gap: 2px;
            background-color: #93c5fd;
        }
        .cell {
            background-color: #eff6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.2rem, 5vmin, 2rem); /* vmin を使ってレスポンシブに */
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid #dbeafe;
            border-radius: 4px;
        }
        .cell:hover {
            background-color: #dbeafe;
        }
        .piece-p1 { color: #2563eb; }
        .piece-p2 .piece-symbol {
            display: inline-block;
            transform: rotate(180deg);
        }
        .piece-p2 { color: #e11d48; }


        .selected {
            background-color: #fcd34d !important;
            outline: 3px solid #f59e0b;
        }
        .valid-move {
            background-color: #86efac !important;
            outline: 3px solid #16a34a;
        }
        .info-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            text-align: center;
            width: 100%; /* 親要素に追従 */
            max-width: 500px; /* ボードに合わせる */
        }
        .info-panel h2 {
            font-size: clamp(1.1rem, 4.5vw, 1.6rem);
            margin-bottom: 10px;
            color: #1e3a8a;
        }
        .info-panel p {
            font-size: clamp(0.9rem, 3.5vw, 1.1rem);
            color: #374151;
            margin-bottom: 8px;
        }
        button {
            background-color: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: clamp(0.9rem, 3.5vw, 1.1rem);
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
        }
        button:hover {
            background-color: #2563eb;
        }

        /* 操作説明エリア */
        .how-to-play {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            width: 280px; /* 固定幅に設定 */
            flex-shrink: 0; /* このエリアは縮まないようにする */
            align-self: flex-start;
        }
        .how-to-play h3 {
            font-size: clamp(1.1rem, 4.5vw, 1.5rem);
            color: #1e3a8a;
            margin-bottom: 16px;
            border-bottom: 2px solid #60a5fa;
            padding-bottom: 8px;
        }
        .how-to-play p {
            font-size: clamp(0.85rem, 3vw, 1rem);
            color: #374151;
            margin-bottom: 10px;
        }
        .how-to-play .piece-move-explanation {
            margin-bottom: 20px;
        }
        .how-to-play .piece-name {
            font-weight: bold;
            font-size: clamp(1rem, 3.8vw, 1.2rem);
            margin-bottom: 8px;
            display: block;
        }
        .piece-p1-example { color: #2563eb; }
        .piece-p2-example { color: #e11d48; }
        .piece-p2-example .piece-symbol-example {
            display: inline-block;
            transform: rotate(180deg);
        }

        .move-grid {
            display: grid;
            grid-template-columns: repeat(3, 28px); /* 少し大きく */
            grid-template-rows: repeat(3, 28px);
            gap: 1px;
            background-color: #cbd5e1;
            border: 1px solid #94a3b8;
            margin-bottom: 8px;
            width: 86px; /* (28*3) + (1*2) */
            height: 86px;
        }
        .move-grid-cell {
            width: 28px;
            height: 28px;
            background-color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem; /* 少し大きく */
        }
        .move-grid-cell.piece {
            /* スタイルはJSで適用 */
        }
        .move-grid-cell.highlight {
            background-color: #86efac;
            outline: 1px solid #16a34a;
        }

        /* モバイル用調整: 画面幅が820px以下の場合 */
        @media (max-width: 820px) { /* ブレークポイント調整 */
            .game-container {
                flex-direction: column;
                align-items: center;
            }
            .how-to-play {
                width: 100%; /* モバイルでは幅を広げる */
                max-width: 500px; /* ボードに合わせる */
                margin-top: 24px;
                align-self: center;
            }
            .board-container, .info-panel {
                 width: 100%; /* モバイルでは幅を広げる */
                 max-width: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="board-and-info-panel">
            <div class="board-container">
                <div id="gameBoard" class="board">
                    </div>
            </div>
            <div id="infoPanel" class="info-panel">
                <h2 id="gameTitle">どうぶつおやつパーティー</h2>
                <p id="turnDisplay">プレイヤー1の番です</p>
                <p id="messageDisplay"></p>
                <button id="resetButton">ゲームリセット</button>
            </div>
        </div>

        <div class="how-to-play">
            <h3>あそびかた</h3>
            <p><strong>もくてき:</strong> あいての <span class="piece-p1-example">ライオン</span><span class="piece-symbol-example">🦁</span> をつかまえたら勝ち！</p>
            
            <h4>駒のうごき</h4>
            <div id="pieceMoveExamplesContainer">
                </div>
            <p><small>※ <span class="piece-p1-example">青い駒</span>があなた (下側)、<span class="piece-p2-example">赤い駒 (<span class="piece-symbol-example">例：</span><span class="piece-p2-example piece-symbol-example">🐺</span>)</span>があいて (上側) です。</small></p>
        </div>
    </div>

    <script>
        // --- 定数定義 ---
        const BOARD_ROWS = 4;
        const BOARD_COLS = 5;
        const EMPTY_CELL = null;

        const PIECES = {
            LION: { 
                name: "ライオン", 
                p1Symbol: "🦁", 
                p2Symbol: "🐺",
                moves: [ [-1,-1], [-1,0], [-1,1], [0,-1], [0,1], [1,-1], [1,0], [1,1] ] 
            },
            BEAR: { 
                name: "くま", 
                p1Symbol: "🐻", 
                p2Symbol: "🐼",
                movesP1: [ [-1,-1], [-1,0], [-1,1] ], 
                movesP2: [ [1,-1], [1,0], [1,1] ]    
            },
            RABBIT: { 
                name: "うさぎ", 
                p1Symbol: "🐰", 
                p2Symbol: "🦊",
                movesP1: [ [-1,-1], [-1,1], [0,-1], [0,1] ], 
                movesP2: [ [1,-1], [1,1], [0,-1], [0,1] ]    
            }
        };

        const PLAYER_1 = "P1";
        const PLAYER_2 = "P2";

        let board = [];
        let currentPlayer = PLAYER_1;
        let selectedPiece = null;
        let gameOver = false;

        const gameBoardElement = document.getElementById('gameBoard');
        const turnDisplayElement = document.getElementById('turnDisplay');
        const messageDisplayElement = document.getElementById('messageDisplay');
        const resetButtonElement = document.getElementById('resetButton');
        const pieceMoveExamplesContainer = document.getElementById('pieceMoveExamplesContainer');


        function createMoveExampleGrid(pieceKey, playerForExample) {
            const pieceInfo = PIECES[pieceKey];
            const exampleDiv = document.createElement('div');
            exampleDiv.classList.add('piece-move-explanation');

            const nameSpan = document.createElement('span');
            nameSpan.classList.add('piece-name');
            nameSpan.textContent = `${pieceInfo.name} (`;
            
            const p1SymbolSpan = document.createElement('span');
            p1SymbolSpan.classList.add('piece-p1-example');
            p1SymbolSpan.textContent = pieceInfo.p1Symbol;
            nameSpan.appendChild(p1SymbolSpan);
            
            nameSpan.append(" / ");

            const p2SymbolSpan = document.createElement('span');
            p2SymbolSpan.classList.add('piece-p2-example');
            const p2InnerSymbol = document.createElement('span');
            p2InnerSymbol.classList.add('piece-symbol-example'); 
            p2InnerSymbol.textContent = pieceInfo.p2Symbol;
            p2SymbolSpan.appendChild(p2InnerSymbol);
            nameSpan.appendChild(p2SymbolSpan);

            nameSpan.append(")");
            exampleDiv.appendChild(nameSpan);

            const grid = document.createElement('div');
            grid.classList.add('move-grid');

            const centerR = 1, centerC = 1; 
            let moveDeltas = [];

            if (pieceInfo.moves) { 
                moveDeltas = pieceInfo.moves;
            } else if (playerForExample === PLAYER_1 && pieceInfo.movesP1) {
                moveDeltas = pieceInfo.movesP1;
            } else if (playerForExample === PLAYER_2 && pieceInfo.movesP2) {
                moveDeltas = pieceInfo.movesP2;
            }

            for (let r = 0; r < 3; r++) {
                for (let c = 0; c < 3; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('move-grid-cell');
                    if (r === centerR && c === centerC) {
                        cell.classList.add('piece');
                        cell.textContent = pieceInfo.p1Symbol; 
                        cell.style.color = '#2563eb'; // P1カラーで固定
                    } else {
                        const dr = r - centerR;
                        const dc = c - centerC;
                        if (moveDeltas.some(delta => delta[0] === dr && delta[1] === dc)) {
                            cell.classList.add('highlight');
                        }
                    }
                    grid.appendChild(cell);
                }
            }
            exampleDiv.appendChild(grid);
            return exampleDiv;
        }

        function populateMoveExamples() {
            pieceMoveExamplesContainer.innerHTML = ''; 
            pieceMoveExamplesContainer.appendChild(createMoveExampleGrid('LION', PLAYER_1));
            pieceMoveExamplesContainer.appendChild(createMoveExampleGrid('BEAR', PLAYER_1));
            pieceMoveExamplesContainer.appendChild(createMoveExampleGrid('RABBIT', PLAYER_1));
        }


        function initializeBoard() {
            board = Array(BOARD_ROWS).fill(null).map(() => Array(BOARD_COLS).fill(EMPTY_CELL));
            gameOver = false;
            currentPlayer = PLAYER_1;
            selectedPiece = null;
            messageDisplayElement.textContent = "";
            updateTurnDisplay();

            board[3][0] = { type: PIECES.BEAR, player: PLAYER_1 };
            board[3][1] = { type: PIECES.RABBIT, player: PLAYER_1 };
            board[3][2] = { type: PIECES.LION, player: PLAYER_1 };
            board[3][3] = { type: PIECES.RABBIT, player: PLAYER_1 };
            board[3][4] = { type: PIECES.BEAR, player: PLAYER_1 };

            board[0][0] = { type: PIECES.BEAR, player: PLAYER_2 };
            board[0][1] = { type: PIECES.RABBIT, player: PLAYER_2 };
            board[0][2] = { type: PIECES.LION, player: PLAYER_2 };
            board[0][3] = { type: PIECES.RABBIT, player: PLAYER_2 };
            board[0][4] = { type: PIECES.BEAR, player: PLAYER_2 };
            
            populateMoveExamples(); 
            renderBoard();
        }

        function renderBoard() {
            gameBoardElement.innerHTML = '';
            for (let r = 0; r < BOARD_ROWS; r++) {
                for (let c = 0; c < BOARD_COLS; c++) {
                    const cellElement = document.createElement('div');
                    cellElement.classList.add('cell');
                    cellElement.dataset.r = r;
                    cellElement.dataset.c = c;

                    const pieceData = board[r][c];
                    if (pieceData) {
                        const symbolSpan = document.createElement('span');
                        symbolSpan.classList.add('piece-symbol'); 
                        symbolSpan.textContent = pieceData.player === PLAYER_1 ? pieceData.type.p1Symbol : pieceData.type.p2Symbol;
                        cellElement.appendChild(symbolSpan);
                        cellElement.classList.add(pieceData.player === PLAYER_1 ? 'piece-p1' : 'piece-p2');
                    }

                    if (selectedPiece && selectedPiece.r === r && selectedPiece.c === c) {
                        cellElement.classList.add('selected');
                    }

                    if (selectedPiece) {
                        const validMoves = getValidMoves(selectedPiece.r, selectedPiece.c, selectedPiece.player, selectedPiece.piece);
                        if (validMoves.some(move => move.r === r && move.c === c)) {
                            cellElement.classList.add('valid-move');
                        }
                    }
                    
                    cellElement.addEventListener('click', () => handleCellClick(r, c));
                    gameBoardElement.appendChild(cellElement);
                }
            }
        }

        function handleCellClick(r, c) {
            if (gameOver) return;

            const clickedCellContent = board[r][c];

            if (selectedPiece) {
                const validMoves = getValidMoves(selectedPiece.r, selectedPiece.c, selectedPiece.player, selectedPiece.piece);
                const isMoveValid = validMoves.some(move => move.r === r && move.c === c);

                if (isMoveValid) {
                    movePiece(selectedPiece.r, selectedPiece.c, r, c);
                } else if (clickedCellContent && clickedCellContent.player === currentPlayer) {
                    selectedPiece = { r, c, piece: clickedCellContent.type, player: clickedCellContent.player };
                    messageDisplayElement.textContent = `${selectedPiece.piece.name}をせんたく中。`;
                } else {
                    messageDisplayElement.textContent = "そこにはうごけません。ほかの駒をえらぶか、ゆうこうなマスをえらんでください。";
                    selectedPiece = null; 
                }
            } else {
                if (clickedCellContent && clickedCellContent.player === currentPlayer) {
                    selectedPiece = { r, c, piece: clickedCellContent.type, player: clickedCellContent.player };
                    messageDisplayElement.textContent = `${selectedPiece.piece.name}をせんたくしました。いどう先をえらんでください。`;
                } else if (clickedCellContent) {
                    messageDisplayElement.textContent = "あいての駒です。じぶんの駒をえらんでください。";
                } else {
                     messageDisplayElement.textContent = "駒をえらんでください。";
                }
            }
            renderBoard();
        }

        function movePiece(fromR, fromC, toR, toC) {
            const pieceToMove = board[fromR][fromC];
            const targetContent = board[toR][toC];

            if (targetContent && targetContent.type === PIECES.LION) {
                board[toR][toC] = pieceToMove;
                board[fromR][fromC] = EMPTY_CELL;
                renderBoard();
                gameOver = true;
                messageDisplayElement.textContent = `${currentPlayer === PLAYER_1 ? "プレイヤー1" : "プレイヤー2"} の勝ち！ ${targetContent.type.name} をつかまえた！`;
                turnDisplayElement.textContent = "ゲームしゅうりょう";
                selectedPiece = null;
                return;
            }

            if (targetContent) {
                 messageDisplayElement.textContent = `${pieceToMove.type.name}であいての${targetContent.type.name}をつかまえた！`;
            } else {
                 messageDisplayElement.textContent = `${pieceToMove.type.name}をうごかしました。`;
            }

            board[toR][toC] = pieceToMove;
            board[fromR][fromC] = EMPTY_CELL;
            
            selectedPiece = null;
            switchPlayer();
        }

        function getValidMoves(r, c, player, pieceType) {
            const moves = [];
            if (!pieceType) return moves;

            let moveDeltas = [];
            if (pieceType.moves) { 
                moveDeltas = pieceType.moves;
            } else if (player === PLAYER_1 && pieceType.movesP1) {
                moveDeltas = pieceType.movesP1;
            } else if (player === PLAYER_2 && pieceType.movesP2) {
                moveDeltas = pieceType.movesP2;
            }

            for (const [dr, dc] of moveDeltas) {
                const nr = r + dr;
                const nc = c + dc;
                if (isValidSquare(nr, nc, player)) moves.push({ r: nr, c: nc });
            }
            return moves;
        }

        function isValidSquare(r, c, player) {
            if (r < 0 || r >= BOARD_ROWS || c < 0 || c >= BOARD_COLS) {
                return false;
            }
            const targetCell = board[r][c];
            if (targetCell && targetCell.player === player) {
                return false;
            }
            return true; 
        }

        function switchPlayer() {
            currentPlayer = (currentPlayer === PLAYER_1) ? PLAYER_2 : PLAYER_1;
            updateTurnDisplay();
            if (!gameOver) {
                 messageDisplayElement.textContent = ""; 
            }
            renderBoard(); 
        }

        function updateTurnDisplay() {
            turnDisplayElement.textContent = gameOver ? "ゲームしゅうりょう" : `${currentPlayer === PLAYER_1 ? "プレイヤー1 (下側)" : "プレイヤー2 (上側)"} の番です`;
        }

        resetButtonElement.addEventListener('click', initializeBoard);

        initializeBoard();
    </script>
</body>
</html>
